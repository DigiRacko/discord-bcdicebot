<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>discord-bcdicebot</title>
	<style type="text/css">

		body > * {
			width: 70%;
			margin-left:15%;
		}
		
		h2 {
			border-left: 24px double green;
			border-bottom: 4px solid green;
			padding-left: 4px;
		}
		h3 {
			border-left: 12px double green;
			border-bottom: 2px solid green;
			padding-left: 4px;
		}
		
		pre {
			margin-top:4px;
			margin-bottom:4px;
			padding-left:20px;
		}
		
		.comment {
			margin:auto;
			width: 60%;
			background-color: #FFFFF0;
			border: #FFFFD0 inset 2px;
		}
	</style>
</head>
<body>
<h1>discord-bcdicebot</h1>
<h2>概要</h2>
<p>Discord で BCDice を使うための bot です。各サーバに対して、ユーザが導入して利用します。</p>
<p><a href="https://drive.google.com/file/d/0BwmXeRuZhw9oUzBINlJUdEp2eGM/view?usp=sharing">DOWNLOAD</a></p>
<h2>必要なもの</h2>
<p>このアプリは Discord のチャットに参加するユーザのうち、1人の環境で動かす必要があります。動かす人には以下の準備が求められます</p>
<h3>Java 8 ないしそれ以降の実行環境</h3>
<p>Java 実行環境 のインストール方法は <a href="https://www.java.com/ja/download/help/download_options.xml">Javaをインストールするには</a> をご覧ください。</p>

<h3>BCDice-API サーバ</h3>
<p><a href="https://github.com/NKMR6194/bcdice-api">BCDice-API</a> が動作しているサーバを用意してください。ローカルでも構いませんし、貸してくれる人から借りてもかまいません。</p>

<h3>(推奨) Windows</h3>
<p>現時点では簡易起動スクリプト (後述の start.bat) は Windows 向けの物しか用意していません。 start.bat の中身を読み解いていただければ Mac でも Linux でも動作は可能です。</p>


<h2>使い方</h2>
<h3>ダイスボットを登録する</h3>
<p>Discord に新規の Bot を作成します。サーバ1つにつき代表者1人がいれれば大丈夫です</p>
<ol>
	<li><a href="https://discordapp.com/developers/applications/me">開発者ページ</a> にアクセスし、New APP をクリックします</li>
	<li>最低限 APP NAME と APP ICON を入力し、 Create App をクリックします</li>
	<li>Create Bot User というボタンをクリックし、このダイスボット用のユーザを作成します</li>
	<li>Bot の Username の下に "Token:click to reveal" というのがあるのでクリックし、出てくるランダムな文字列をメモします<br/><strong>この文字列は他の人に教えないこと</strong>。</li>
	<li>画面上部の APP DETAILS のところに書かれた Client ID の数字をメモします</li>
	<li>次の URL にアクセスします<br/><strong>https://discordapp.com/oauth2/authorize?client_id=<span style="color:green;">[Client Id の数字]</span>&amp;scope=bot&amp;permissions=0</strong></li>
</ol>

<h3>アプリケーションを起動する</h3>
<p>Bot を起動し、 Discord 上で BCDice を利用可能にします。サーバ1つにつき代表者1人がアプリを起動すれば大丈夫です</p>
<ol>
	<li>start.bat をメモ帳で開きます</li>
	<li><strong>set DISCORD_BOT_TOKEN=</strong> の末尾に先の 4. でメモした Token を貼り付けます</li>
	<li><strong>set BCDICE_API_URL=</strong> の末尾に利用する BCDice-API サーバの URL を貼り付けます</li>
	<li>メモ帳を閉じ、 start.bat をダブルクリックします</li>
	<li>Discord の参加者一覧に Bot がオンラインの状態で存在すれば成功です</li>
	<li>終了はキーボードの Ctrl + C を押してください</li>
</ol>

<div class="comment">
<p>BCDice-API サーバとして大ちゃんさんが公開してくださっているものがあります。自分で BCDice-API サーバを構築するのが難しいようであればそこを借りるのも手でしょう。</p>
<p>詳しい話は <a href="https://www.taruki.com/wp/?p=6507">bcdice-api | 大ちゃんのいろいろ雑記</a> をご確認ください。</p>
</div>

<h3>コマンドを利用する</h3>
<p>チャットに <code>bcdice help</code> と打てば使えるコマンドの一覧が出力されます</p>
<p>まずは利用するダイスボットにダイスボットを切り替えましょう。<br/><code>bcdice set [利用するダイスボットの名前]</code><br/>例えば <code>bcdice set SwordWorld2.0</code></p>
<p>ダイスボットの切り替えが終わったらダイスを振るコマンドを打ってみましょう。振れます</p>

<h3>管理コマンドを使う</h3>
<p>チャットに <code>bcdice admin [パスワード] help</code> と打てば管理者として利用できるコマンドの一覧が出力されます</p>
<p>接続する BCDice-API サーバを変更する場合は <code>bcdice admin [パスワード] [BCDice-APIサーバのURL]</code></p>
<p>各部屋ごとに設定されたダイスボットの一覧を取得する場合は <code>bcdice admin [パスワード] export</code><br/>以下のような結果が得られます</p>
<pre>
331084010098917376:SwordWorld2.0
551310555730673666:DoubleCross
541477835299356673:Cthulhu
</pre>
<p>複数の部屋に対してダイスボットを設定する場合は以下のようにします。<br/>アプリを再起動した際は全部屋のダイスボット設定がリセットされますので、import と組み合わせると原状復帰が容易です</p><pre>bcdice admin [パスワード] import
331084010098917376:SwordWorld2.0
551310555730673666:DoubleCross
541477835299356673:Cthulhu</pre>

<h2>連絡先</h2>
<h3>バグ報告など</h3>
<p>Twitter アカウントは<a href="https://twitter.com/Shunshun94">@Shunshun94</a>。ないしはリポジトリに issue を追加してください。</p>
<h3>寄付先</h3>
<p><a href="http://amzn.asia/8mNqdKy">Amazon のウィッシュリスト</a></p>

<h2>ライセンス</h2>

<h3>使用しているライブラリ</h3>
<dl>
	<dt><a href="https://github.com/BtoBastian/Javacord">javacord</a></dt>
	<dd>Discord との通信で使用。<a href="https://github.com/BtoBastian/Javacord/blob/master/LICENSE">LGPLv3</a> でライセンスされています。</dd>
	<dt><a href="https://mvnrepository.com/artifact/ch.qos.logback/logback-classic">Logback Classic Module</a></dt>
	<dd>ロガー。LGPLv2.1 でライセンスされています。</dd>
	<dt><a href="https://github.com/resteasy/Resteasy">RESTEasy</a></dt>
	<dd>HTTP クライアント。<a href="https://github.com/resteasy/Resteasy/blob/master/License.html">Aapche 2.0</a> でライセンスされています。</dd>
	<dt><a href="http://commons.apache.org/proper/commons-lang/">Apache Commons Lang</a></dt>
	<dd>java.lang の拡張。<a href="https://github.com/resteasy/Resteasy/blob/master/License.html">Aapche 2.0</a> でライセンスされています。</dd>
</dl>

<h3>利用しているサービス</h3>
<dl>
	<dt><a href="https://github.com/bcdice/BCDice">ゲーム設定型ダイスボット「ボーンズ＆カーズ」</a></dt>
	<dd>どどんとふを初めとする多くのオンセツールで採用されているダイスボット。略称は BCDice。修正BSDライセンスでライセンスされています。</dd>
	<dt><a href="https://github.com/NKMR6194/bcdice-api">BCDice-API</a></dt>
	<dd>BCDice に HTTP による API を付与するラッパ。<a href="https://github.com/NKMR6194/bcdice-api/blob/master/LICENSE">MIT ライセンス</a>でライセンスされています。</dd>
	<dt><a href="https://discordapp.com/">Discord</a></dt>
	<dd>ボイスチャットアプリ。パソコンからでも携帯からでも利用可能。</dd>
</dl>

<h3>本アプリのライセンス</h3>
<p>このアプリ (ソースコードなどを含む) は <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPLv3</a> でライセンスします。<br/>ソースコードは<a href="https://github.com/Shunshun94/discord-bcdicebot">https://github.com/Shunshun94/discord-bcdicebot</a>から入手可能です。</p>

<h2>Q&amp;A</h2>
<h3>質問・バグ報告はどこに</h3>
<p><a href="https://twitter.com/Shunshun94">@Shunshun94</a> ないしは <a href="https://github.com/Shunshun94/discord-bcdicebot/issues">github の issues</a> に。</p>
<p>どんな出力が出たのか、出力をコピペして頂けると調査が捗ります。</p>
<h3>なんで Java なの。Ruby とか○○とかじゃないの</h3>
<p>一般ユーザの PC に Ruby や○○の実行環境が導入されているとは思えなかった</p>
<h3>じゃあ単体実行できるバイナリでいいじゃん</h3>
<p>Mac ユーザやら Linux ユーザやらごとにバイナリを作るのが面倒だった。 Linux はともかく Mac ユーザはいる気がしたから</p>
<h3>ダイスを振るコマンド以外を入力すると <strong>[ERROR][500] ～</strong> って出る。設定は合っているはずなのに</h3>
<p>start.bat の <strong>IGNORE_ERROR=0</strong> の 0　を 1 と書き入れてみてください。治るかもしれません</p>
<h3>管理用のパスワードはどこ？</h3>
<p>起動直後に <code>Admin Password: SGO7C0XYtBJouE75</code> みたいな文字列がでます。この英数字ランダム16桁の文字列がパスワードです。起動するたびに変わるので注意してください</p>

<h2>謝辞</h2>
<h3>お世話になった方々</h3>

<p>BCDice を作成・公開してくださった<a href="http://faceless-tools.cocolog-nifty.com/about.html">Faceless</a>さんと、
Ruby 移植をしてくださった<a href="https://twitter.com/torgtaitai">たいたい竹流</a>さん。
さらにメンテを引き継いでくださっている<a href="https://twitter.com/ysakasin">酒田　シンジ</a>さん。
そもそも、BCDice が無ければこのアプリは着想すらありませんでした。
BCDice が多機能である点、2017年現在、国内オンラインセッションツールのデファクトスタンダードであるどどんとふが採用しているダイスボットであるため、
国内におけるダイスボットのデファクトスタンダードが BCDice となっていたことが実装の必要を感じたそもそもの理由でした。</p>

<p>BCDice-API を実装・公開してくださった<a href="https://twitter.com/nkmr6194">酒田　シンジ</a>さん。
BCDice-API が無ければ本アプリの実装は気が遠くなるものだったに違いありません。</p>

<p>発表前の動作確認に付き合ってくださった<a href="https://twitter.com/_casi_note">かし＊</a>さんと<a href="https://twitter.com/Lillin">離凛</a>さん。
色々な想定漏れについて指摘していただき、公開前にアプリが大幅に改善されました。</p>

<h3>関連アプリの紹介</h3>
<p><a href="https://twitter.com/Nanasu7">Nanasu</a> さんが作ってくださった<a href="https://bitbucket.org/Nanasu/bcdiscord-for-browser">BCDiscord for Browser</a>　のコマンドは本アプリの物を参考にしてくださいました。
ブラウザのみで動くため、大変に便利です。</p>


<h2>更新履歴</h2>
<dl>
	<dt>v1.9</dt>
	<dd>ダイスボットのスペルが間違えている時に警告が出ない問題を解消</dd>
	<dt>v1.8.1(2019/07/24)</dt>
	<dd>本ドキュメントの軽微な修正を実施。</dd>
	<dt>v1.8(2019/07/23)</dt>
	<dd>ダイスコマンドに関するバグを修正 (<a href="https://github.com/Shunshun94/discord-bcdicebot/issues/13">詳細</a>)。</dd>
	<dd>管理用コマンドとして BCDice-API の接続先を変更する機能を追加</dd>
	<dd>管理用コマンドとして全部屋に設定されたダイスボット一覧を取得する機能を追加</dd>
	<dd>管理用コマンドとして全部屋にダイスボットを設定する機能を追加</dd>
	<dt>v1.7(2019/06/10)</dt>
	<dd>bcdice list でダイスボットの一覧が表示されないことがある問題を修正した</dd>
	<dt>v1.6(2018/11/11)</dt>
	<dd>一部のエラーを無視する機能を追加。詳しくは上述の <q>ダイスを振るコマンド以外を入力すると <strong>[ERROR][500] ～</strong> って出る。設定は合っているはずなのに</q> 参照</dd>
	<dd>設定用コマンドを一部修正した</dd>
	<dt>v1.5(2018/03/24)</dt>
	<dd>ダイスコマンドに関するバグを修正 (<a href="https://github.com/Shunshun94/discord-bcdicebot/pull/10">詳細</a>)。問題の指摘と修正手法の共有をしてくださった<a href="https://github.com/c-ardinal">cardinal</a> さん、ありがとうございます！</dd>
	<dt>v1.4(2017/10/07)</dt>
	<dd>利用しているライブラリ起因の問題に対してライブラリをバージョンアップして対応。問題の指摘をくださった<a href="https://github.com/C0ela">シーラ</a> さん、ありがとうございます！</dd>
	<dd>アプリ終了後に待機するように start.bat を変更。ログの収集が容易になった</dd>
	<dt>v1.3(2017/07/13)</dt>
	<dd>Channel 毎に異なるダイスボットを利用できるように変更。特に設定していない場合は general のものを利用</dd>
	<dt>v1.2(2017/07/06)</dt>
	<dd>BCDice-API v0.4.0 に対応。問題の指摘をくださった<a href="https://twitter.com/nkmr6194">酒田　シンジ</a>さん、ありがとうございます！</dd>
	<dt>v1.1.1(2017/06/30)</dt>
	<dd>本ドキュメントの権利的な問題に対応</dd>
	<dt>v1.1(2017/06/30)</dt>
	<dd>いくらかの内部的な問題を修正。機能への変更はなし</dd>
	<dt>v1.0 (2017/06/26)</dt>
	<dd>公開</dd>
</dl>

</body>
</html>